<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fantasy Football Neuron</title>
    
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- 3. Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* A little extra style for a better look */
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 4. Your React Application Code -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS (SVG paths for use in React) ---
        const icons = {
          brainCircuit: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a10 10 0 0 0-10 10c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85v2.72c0 .27.16.59.67.5A10 10 0 0 0 12 2z" /><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M12 4a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M12 24a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M4 12a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M20 12a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M17.66 17.66a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M6.34 17.66a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M17.66 6.34a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /><path d="M6.34 6.34a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" /></svg>,
          zap: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>,
          cloudy: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/><path d="M22 10a3 3 0 0 0-3-3h-2.207a5.502 5.502 0 0 0-10.702.5"/></svg>,
          trendingUp: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
          refreshCw: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M3 12a9 9 0 0 1 9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>,
          alertTriangle: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
          checkCircle: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
          barChart: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
          server: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>,
          send: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
          sparkles: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.9 4.2-4.2 1.9 4.2 1.9 1.9 4.2 1.9-4.2 4.2-1.9-4.2-1.9L12 3z"/><path d="M5 13l-1 2-2 1 2 1 1 2 1-2 2-1-2-1-1-2z"/><path d="m21 13-1 2-2 1 2 1 1 2 1-2 2-1-2-1-1-2z"/></svg>,
          target: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
          gauge: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"/><path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/><path d="M13.41 10.59l4.24-4.24"/><path d="M7 12h-2"/><path d="M19 12h-2"/></svg>,
          lineChart: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>,
          skull: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1" /><circle cx="15" cy="12" r="1" /><path d="M8 20v2h8v-2" /><path d="M12.5 17.5c-.5.5-1.5.5-2 0" /><path d="M16 20a4 4 0 0 0-8 0" /><path d="M12 2a10 10 0 0 0-10 10c0 4.42 2.87 8.17 6.84 9.5" /></svg>,
        };

        const scenarios = {
            1: {
                id: 1,
                title: "Strategic Pivot Engine (Late-Swap)",
                header: { status: "Live Analysis Active", edge: "+11.2%", roi: "+$1,981", confidence: "78%", dataLatency: "0.8s" },
                controls: ["Breaking News", "Injury Pivot", "New Leverage", "Reset"],
                feed: { icon: icons.zap, title: "BREAKING: Keenan Allen (WR, LAC) UNEXPECTEDLY INACTIVE", description: "31 of your lineups affected. Auto-pivot to rookie Quentin Johnston saves $5,100 per lineup. High-risk, high-reward play with a 79.4 score.", buttons: ["Execute Auto-Pivot (31 lineups)", "Manual Review"] },
                strategicInsight: { title: "High-Risk Pivot", text: "Pivoting to Quentin Johnston offers massive leverage but low floor. Recommended for GPP/Tournament lineups only." },
                players: [ { name: "Quentin Johnston - WR, LAC", score: 88, tournamentScore: 95, leverage: 92.1, ownership: 1.1, ceiling: 94, value: "+$1,850", note: "High-upside GPP play." }, { name: "Joshua Palmer - WR, LAC", score: 74, tournamentScore: 68, leverage: 68.4, ownership: 18.5, ceiling: 77, value: "+$450", note: "Safer cash game pivot." } ],
                chat: { initialMessage: "Monday Night Football surprise! I'm re-analyzing all affected lineups. How do you want to handle the Keenan Allen news?", suggestions: ["Best pivot for GPP?", "Safest cash game play?"] },
            },
            2: {
                id: 2,
                title: "Weather Impact Analysis",
                header: { status: "Live Analysis Active", edge: "+9.8%", roi: "+$1,755", confidence: "85%", dataLatency: "1.1s" },
                controls: ["Breaking News", "Weather Alert", "New Leverage", "Reset"],
                feed: { icon: icons.cloudy, title: "WEATHER ALERT: Heavy snow & 25mph winds confirmed in Green Bay.", description: "Downgrading all passing game players for LV @ GB. Upgrading RBs and D/STs. 58 lineups have exposure.", buttons: ["View Affected Players", "Auto-Optimize Portfolio"] },
                sentiment: { player: "Davante Adams", value: 25, label: "FADE" },
                players: [ { name: "Josh Jacobs - RB, LV", score: 89, tournamentScore: 82, leverage: 81.3, ownership: 19.2, ceiling: 91, value: "+$1,120", note: "Elite play due to weather." }, { name: "Davante Adams - WR, LV", score: 41, tournamentScore: 35, leverage: 25.5, ownership: 24.8, ceiling: 56, value: "-$880", note: "High-risk fade candidate." } ],
                chat: { initialMessage: "The weather in Green Bay is a major factor. I've downgraded passing projections by 40%. Are you ready to pivot?", suggestions: ["Who benefits most?", "Show me fade candidates."] },
            },
            3: {
                id: 3,
                title: "Game Theory Engine (Contrarian Play)",
                header: { status: "Live Analysis Active", edge: "+22.5%", roi: "+$4,150", confidence: "92%", dataLatency: "0.9s" },
                controls: ["Breaking News", "Weather Alert", "New Leverage", "Reset"],
                feed: { icon: icons.trendingUp, title: "LEVERAGE ALERT: Tank Dell ownership is inexplicably low (<2%).", description: "He is in an elite matchup and projects as a top-5 value. Perfect GPP tournament play to differentiate your lineups.", buttons: ["Increase Exposure", "Analyze Matchup"] },
                strategicInsight: { title: "GPP-Winning Play", text: "Tank Dell's combination of low ownership and high ceiling presents a rare opportunity to gain significant ground on the field in large tournaments." },
                players: [ { name: "Tank Dell - WR, HOU", score: 94, tournamentScore: 98, leverage: 95.8, ownership: 1.9, ceiling: 96, value: "+$2,100", note: "Elite GPP tournament play." }, { name: "CeeDee Lamb - WR, DAL", score: 65, tournamentScore: 60, leverage: 40.1, ownership: 38.7, ceiling: 92, value: "-$250", note: "High ownership 'chalk' play." } ],
                chat: { initialMessage: "I've identified a massive leverage opportunity with Tank Dell. This is the kind of play that wins tournaments. How much exposure should we add?", suggestions: ["Build 10 lineups with Dell.", "Why is he low-owned?"] },
            },
            4: {
                id: 4,
                title: "System Mission Control (HITL Alert)",
                header: { status: "HITL Mode Active", edge: "N/A", roi: "N/A", confidence: "Paused", dataLatency: "Paused" },
                controls: ["Breaking News", "Weather Alert", "New Leverage", "Reset"],
                feed: { icon: icons.alertTriangle, title: "SYSTEM WARNING: LiveExecution Agent has encountered an error.", description: "Automated lineup submission is paused for safety. All recommendations are now in `Manual Mode`. Your funds are safe.", buttons: ["View Status Monitor", "Contact Support"] },
                chat: { initialMessage: "We've detected an issue with the LiveExecution agent and have paused auto-updates. My analysis is still active and I can provide recommendations for you to implement manually.", suggestions: ["What happened?", "Give me manual instructions."] },
            },
            5: {
                id: 5,
                title: "Bankroll & Exposure Management",
                header: { status: "Live Analysis Active", edge: "+14.1%", roi: "+$2,194", confidence: "88%", dataLatency: "1.0s" },
                controls: ["Breaking News", "Weather Alert", "New Leverage", "Reset"],
                feed: { icon: icons.barChart, title: "PORTFOLIO ALERT: High Ownership Concentration.", description: "72% of your lineups feature players from the KC vs. PHI game. This increases portfolio risk. Recommend diversifying exposure.", buttons: ["Run Diversification Optimizer", "Show Me Alternatives"] },
                portfolio: { lineups: 182, investment: "$2,450", edge: "+14.1%", risk: "High", exposure: { "Patrick Mahomes": "68%", "Travis Kelce": "65%", "Jalen Hurts": "58%", "A.J. Brown": "55%" }, winProbData: [20, 22, 28, 25, 35, 40, 38] },
                chat: { initialMessage: "Your portfolio is heavily correlated. While the KC/PHI game has a high ceiling, this strategy reduces your chances of a unique lineup cashing. Shall I build some lower-owned stacks from other games?", suggestions: ["Yes, show me contrarian stacks.", "What is my risk score?"] },
            },
            6: {
                id: 6,
                title: "The Neuron Architecture",
                isStatic: true,
                header: { status: "System Philosophy", edge: "N/A", roi: "N/A", confidence: "N/A", dataLatency: "N/A" },
                chat: { initialMessage: "Welcome. This is the core philosophy behind the Neuron system. Feel free to ask any questions about our approach.", suggestions: ["How is this different?", "Tell me about the agents."] },
                staticContent: {
                    title: "The Neuron Architecture: A Collaborative AI Network",
                    description: "Neuron isn't a single AI model; it's a distributed system of specialized agents that collaborate in real-time. This architecture is designed for resilience, transparency, and strategic depth.",
                    points: [
                        { title: "The Agent Network", text: "Six specialized agents (DataStream, LiveAnalysis, LiveDecision, LiveExecution, PlatformArbitrage, ComplianceMonitor) work in concert. Each has a specific job, from ingesting data to executing trades, allowing for greater efficiency and fault tolerance." },
                        { title: "The SynapticBus", text: "All agents communicate asynchronously through an event-driven message router. This ensures that if one agent is slow or fails, it doesn't bring down the entire system. It's the key to our real-time resilience." },
                        { title: "The Decision Context Store", text: "This is the system's persistent, shared memory. It stores your preferences, risk tolerance, and historical outcomes, ensuring every recommendation from every agent is aligned with your personal strategy." },
                        { title: "The HITL Safety Gateway", text: "Trust is paramount. No critical, automated action is ever taken without passing through our Human-in-the-Loop (HITL) gateway. You always have the final say, with clear risk/reward context provided for every decision." },
                    ]
                }
            },
        };

        const Header = ({ data, statusColor }) => (
          <header className="p-4 text-white border-b border-cyan-900/50">
            <div className="flex justify-between items-center">
              <h1 className="text-xl font-bold flex items-center gap-2 text-cyan-300">
                <span className="w-6 h-6">{icons.brainCircuit}</span>
                Fantasy Football Neuron
              </h1>
              <div className="flex items-center gap-2 text-sm">
                <div className={`w-2 h-2 rounded-full ${statusColor} animate-pulse`}></div>
                <span className="font-semibold">{data.status}</span>
              </div>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-2 text-sm mt-4 text-gray-400">
                <div className="flex flex-col"><span className="text-xs">Portfolio Edge</span><strong className="text-lg text-green-400">{data.edge}</strong></div>
                <div className="flex flex-col"><span className="text-xs">Projected ROI</span><strong className="text-lg text-green-400">{data.roi}</strong></div>
                <div className="flex flex-col"><span className="text-xs">System Confidence</span><strong className="text-lg text-white">{data.confidence}</strong></div>
                <div className="flex flex-col"><span className="text-xs">Data Latency</span><strong className="text-lg text-white">{data.dataLatency}</strong></div>
            </div>
          </header>
        );

        const Controls = ({ items, onAction }) => (
          <div className="flex space-x-2 p-3 bg-black/20 text-sm border-b border-cyan-900/50">
            {items.map(item => {
              const iconMap = { "News": icons.zap, "Weather": icons.cloudy, "Leverage": icons.trendingUp, "Reset": icons.refreshCw, "Pivot": icons.refreshCw };
              const key = Object.keys(iconMap).find(k => item.includes(k));
              return (
                <button 
                  key={item} 
                  onClick={() => onAction(`User clicked the '${item}' filter. As Neuron AI, please respond to this action.`)}
                  className="bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-1 rounded-full flex items-center space-x-2 transition-colors duration-200">
                  <span className="w-4 h-4">{iconMap[key]}</span>
                  <span>{item}</span>
                </button>
              );
            })}
          </div>
        );

        const LiveIntelligenceFeed = ({ data, onAction }) => (
          <div className="p-4 border-b border-cyan-900/50">
            <h2 className="text-lg font-bold text-cyan-300 flex items-center gap-3"><span className="w-8 h-8 flex items-center justify-center bg-cyan-900/50 text-cyan-300 rounded-lg">{data.icon}</span>{data.title}</h2>
            <p className="text-gray-300 mt-2 pl-11">{data.description}</p>
            <div className="flex space-x-2 mt-4 pl-11">
              {data.buttons.map((btn, index) => (
                <button 
                  key={btn} 
                  onClick={() => onAction(`User clicked the '${btn}' button. As Neuron AI, confirm this action and explain what happens next.`)}
                  className={`px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 ${index === 0 ? 'bg-cyan-600 hover:bg-cyan-500 text-white shadow-[0_0_15px_rgba(0,255,255,0.3)]' : 'bg-gray-700 hover:bg-gray-600 text-gray-200'}`}>
                  {btn}
                </button>
              ))}
            </div>
          </div>
        );

        const SystemStatus = () => {
            const agents = [
                { name: '🛰️ DataStream', status: 'Active' },
                { name: '🧠 LiveAnalysis', status: 'Active' },
                { name: '🎯 LiveDecision', status: 'Processing' },
                { name: '⚙️ LiveExecution', status: 'Idle' },
                { name: '📈 PlatformArbitrage', status: 'Idle' },
                { name: '⚖️ ComplianceMonitor', status: 'Active' },
            ];
            return (
                <div className="p-4 border-b border-cyan-900/50 bg-black/20">
                    <h3 className="text-md font-semibold text-white mb-3 flex items-center gap-2">{icons.server} Agent Network Status</h3>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-3 text-sm">
                        {agents.map(agent => (
                            <div key={agent.name} className="flex items-center justify-between">
                                <span className="text-gray-300">{agent.name}</span>
                                <div className="flex items-center gap-2">
                                    <div className={`w-2 h-2 rounded-full ${agent.status === 'Active' ? 'bg-green-500' : agent.status === 'Processing' ? 'bg-yellow-500' : 'bg-gray-500'} animate-pulse`}></div>
                                    <span className={`${agent.status === 'Active' ? 'text-green-400' : agent.status === 'Processing' ? 'text-yellow-400' : 'text-gray-400'}`}>{agent.status}</span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )
        };
        
        const StatBar = ({ value, colorClass }) => (<div className="w-full bg-gray-700 rounded-full h-1.5"><div className={`${colorClass} h-1.5 rounded-full`} style={{ width: `${value}%` }}></div></div>);
        const PlayerCard = ({ data }) => (
          <div className="p-4 border-b border-cyan-900/50">
            <div className="flex justify-between items-start mb-3"><h4 className="font-bold text-white">{data.name}</h4><span className="text-xl font-bold text-cyan-300">{data.score}%</span></div>
            <div className="grid grid-cols-3 gap-x-4 gap-y-3 text-sm">
              <div><div className="flex justify-between text-gray-400 mb-1"><span>Leverage</span><strong className="text-white">{data.leverage}</strong></div><StatBar value={data.leverage} colorClass="bg-green-500" /></div>
              <div><div className="flex justify-between text-gray-400 mb-1"><span>Ownership</span><strong className="text-white">{data.ownership}%</strong></div><StatBar value={data.ownership} colorClass={data.ownership < 10 ? 'bg-cyan-500' : 'bg-orange-500'} /></div>
              <div><div className="flex justify-between text-gray-400 mb-1"><span>Tourney Score</span><strong className="text-white">{data.tournamentScore}</strong></div><StatBar value={data.tournamentScore} colorClass="bg-purple-500" /></div>
            </div>
            <p className="text-sm text-cyan-200/70 italic mt-3 flex items-center gap-2"><span className="w-4 h-4">{icons.sparkles}</span>Strategic Insight: {data.note}</p>
          </div>
        );

        const WinProbabilityChart = ({ data }) => {
            const points = data.map((p, i) => `${(i / (data.length - 1)) * 100},${100 - p}`).join(' ');
            return (
                <div className="mt-4">
                    <h4 className="text-sm font-semibold text-white mb-2 flex items-center gap-2">{icons.lineChart} Win Probability</h4>
                    <svg viewBox="0 0 100 100" className="w-full h-24 bg-gray-900/50 rounded-lg p-2">
                        <polyline fill="none" stroke="#06b6d4" strokeWidth="2" points={points} />
                    </svg>
                </div>
            );
        };

        const SentimentGauge = ({ value, label, player }) => {
            return (
                <div className="p-4 border-b border-cyan-900/50">
                    <h3 className="text-md font-semibold text-white mb-2 flex items-center gap-2">{icons.gauge} Market Sentiment: {player}</h3>
                    <div className="relative w-48 h-24 mx-auto">
                        <svg viewBox="0 0 100 50" className="w-full h-full">
                            <path d="M 10 50 A 40 40 0 0 1 90 50" fill="none" stroke="#374151" strokeWidth="8" />
                            <path d="M 10 50 A 40 40 0 0 1 90 50" fill="none" stroke="#06b6d4" strokeWidth="8" strokeDasharray={`${value}, 100`} />
                        </svg>
                        <div className="absolute bottom-0 w-full text-center">
                            <div className="text-2xl font-bold text-cyan-300">{label}</div>
                            <div className="text-xs text-gray-400">{value}% Bullish</div>
                        </div>
                    </div>
                </div>
            );
        };

        const StrategicInsight = ({ data }) => (
            <div className="p-4 border-b border-cyan-900/50 bg-cyan-900/20">
                <h3 className="text-md font-semibold text-cyan-300 mb-2 flex items-center gap-2">{icons.target} Strategic Alpha</h3>
                <p className="text-sm text-white"><strong className="font-semibold">{data.title}:</strong> {data.text}</p>
            </div>
        );

        const PortfolioCommandCenter = ({ data }) => (
            <div className="p-4 border-b border-cyan-900/50">
                <h3 className="text-md font-semibold text-white mb-3 flex items-center gap-2">{icons.barChart} Portfolio Command Center</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-gray-900/50 p-3 rounded-lg text-center"><div className="text-gray-400 text-xs">Active Lineups</div><div className="text-white text-xl font-bold">{data.lineups}</div></div>
                    <div className="bg-gray-900/50 p-3 rounded-lg text-center"><div className="text-gray-400 text-xs">Total Investment</div><div className="text-white text-xl font-bold">{data.investment}</div></div>
                    <div className="bg-gray-900/50 p-3 rounded-lg text-center"><div className="text-gray-400 text-xs">Projected Edge</div><div className="text-green-400 text-xl font-bold">{data.edge}</div></div>
                    <div className="bg-gray-900/50 p-3 rounded-lg text-center"><div className="text-gray-400 text-xs">Risk Score</div><div className="text-orange-400 text-xl font-bold">{data.risk}</div></div>
                </div>
                <div className="mt-4"><h4 className="text-sm font-semibold text-white mb-2">Exposure Overview</h4><div className="flex flex-wrap gap-2 text-xs">{Object.entries(data.exposure).map(([player, percentage]) => (<div key={player} className="bg-gray-800 p-2 rounded"><span className="text-gray-300">{player}: </span><strong className="text-white">{percentage}</strong></div>))}</div></div>
                {data.winProbData && <WinProbabilityChart data={data.winProbData} />}
            </div>
        );
        
        const RiskProfile = ({ risk, setRisk }) => {
            const labels = ["Conservative", "Balanced", "Aggressive", "All-In"];
            return (
                <div className="p-4 bg-black/20 border-b border-cyan-900/50">
                    <label htmlFor="risk-slider" className="block text-sm font-medium text-white mb-2">Your Risk Profile: <span className="font-bold text-cyan-400">{labels[risk]}</span></label>
                    <input
                        id="risk-slider"
                        type="range"
                        min="0"
                        max="3"
                        value={risk}
                        onChange={(e) => setRisk(Number(e.target.value))}
                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                    />
                </div>
            );
        };
        
        const TrashTalkGenerator = ({ onGenerate }) => {
            return (
                <div className="p-4">
                    <button 
                        onClick={onGenerate}
                        className="w-full bg-red-800/50 hover:bg-red-700/50 border border-red-600/50 text-red-300 px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-all duration-200">
                        <span className="w-5 h-5">{icons.skull}</span>
                        Generate Trash Talk
                    </button>
                </div>
            )
        }

        const Chat = ({ messages, suggestions, onSendMessage, isTyping, risk, setRisk, onGenerateTrashTalk }) => {
          const [userInput, setUserInput] = useState('');
          const chatEndRef = useRef(null);
          useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages, isTyping]);
          const handleSend = () => { if (userInput.trim()) { onSendMessage(userInput); setUserInput(''); } };
          const handleSuggestionClick = (suggestion) => { onSendMessage(suggestion); }
          return (
            <div className="p-4 flex-grow flex flex-col bg-gray-900/50 h-full">
              <RiskProfile risk={risk} setRisk={setRisk} />
              <div className="flex-grow overflow-y-auto pr-2" style={{maxHeight: 'calc(100vh - 350px)'}}>
                {messages.map((msg, index) => (
                  <div key={index} className={`my-4 flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`p-3 rounded-lg max-w-xs lg:max-w-md ${msg.role === 'user' ? 'bg-cyan-800 text-white' : 'bg-black/20 border border-cyan-900/30 text-white'}`}>
                      <p className="text-sm font-semibold mb-1">{msg.role === 'user' ? 'You' : 'Neuron AI'}</p>
                      <p className="text-sm whitespace-pre-wrap">{msg.text}</p>
                    </div>
                  </div>
                ))}
                {isTyping && (
                   <div className="my-4 flex justify-start">
                     <div className="p-3 rounded-lg bg-black/20 border border-cyan-900/30 text-white">
                       <p className="text-sm font-semibold mb-1">Neuron AI</p>
                       <div className="flex items-center gap-2">
                           <div className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse delay-75"></div>
                           <div className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse delay-150"></div>
                           <div className="w-2 h-2 bg-cyan-400 rounded-full animate-pulse delay-300"></div>
                       </div>
                     </div>
                   </div>
                )}
                <div ref={chatEndRef} />
              </div>
              <div className="flex flex-wrap gap-2 my-3">
                {suggestions.map(sugg => (
                  <button key={sugg} onClick={() => handleSuggestionClick(sugg)} className="bg-gray-700 hover:bg-gray-600 text-gray-200 text-xs px-3 py-1.5 rounded-full transition-colors duration-200">{sugg}</button>
                ))}
              </div>
              <div className="mt-auto flex items-center bg-gray-800 rounded-lg p-1 border border-cyan-900/50 focus-within:border-cyan-500 transition-colors duration-200">
                <input type="text" placeholder="Engage with Neuron AI..." className="bg-transparent w-full text-white placeholder-gray-500 focus:outline-none px-2" value={userInput} onChange={(e) => setUserInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSend()} />
                <button onClick={handleSend} disabled={isTyping} className="bg-cyan-600 hover:bg-cyan-500 text-white p-2 rounded-md transition-colors duration-200 disabled:bg-gray-600"><span className="w-5 h-5">{icons.send}</span></button>
              </div>
              <TrashTalkGenerator onGenerate={onGenerateTrashTalk} />
            </div>
          );
        };

        function App() {
          const [scenarioId, setScenarioId] = useState(1);
          const [isTransitioning, setIsTransitioning] = useState(false);
          const [messages, setMessages] = useState([]);
          const [isTyping, setIsTyping] = useState(false);
          const [risk, setRisk] = useState(1); // 0: Conservative, 1: Balanced, 2: Aggressive, 3: All-In

          const currentScenario = scenarios[scenarioId];
          const statusColor = currentScenario.header.status === 'HITL Mode Active' ? 'bg-yellow-500' : 'bg-green-500';
          
          useEffect(() => {
            if (currentScenario.chat) {
              setMessages([{ role: 'model', text: currentScenario.chat.initialMessage }]);
            }
          }, [scenarioId]);

          const handleScenarioChange = (id) => {
            setIsTransitioning(true);
            setTimeout(() => {
              setScenarioId(id);
              setIsTransitioning(false);
            }, 300);
          };

          const handleInteraction = async (interactionText, isButtonAction = false, isTrashTalk = false) => {
            const newMessages = isButtonAction ? [...messages] : [...messages, { role: 'user', text: interactionText }];
            if (!isButtonAction) { setMessages(newMessages); }
            setIsTyping(true);
            
            const riskLabels = ["Conservative", "Balanced", "Aggressive", "All-In"];
            const userRiskProfile = riskLabels[risk];

            let context = `Title: ${currentScenario.title}\nStatus: ${currentScenario.header.status}`;
            if (currentScenario.feed) {
                context += `\nAlert: ${currentScenario.feed.title} - ${currentScenario.feed.description}`;
            }
            if (currentScenario.strategicInsight) {
                context += `\nStrategic Insight: ${currentScenario.strategicInsight.title} - ${currentScenario.strategicInsight.text}`;
            }
            if (currentScenario.players) {
                const playerInfo = currentScenario.players.map(p => `${p.name} (Score: ${p.score}, Ownership: ${p.ownership}%)`).join('; ');
                context += `\nKey Players: ${playerInfo}`;
            }

            let fullPrompt;
            if (isTrashTalk) {
                fullPrompt = `
                  **Persona:** You are Neuron AI.
                  **Special Instruction:** The user wants you to generate a piece of trash talk for their league opponent. Frame the trash talk as if one of your internal agents has just delivered a critical piece of intel. Make it sound like an inside scoop that gives the user a massive edge.
                  
                  **Rules for Trash Talk Generation:**
                  1.  **Choose an Agent:** Pick one of your agents (DataStream, LiveAnalysis, LiveDecision) as the source of the intel.
                  2.  **State the "Intel":** Briefly mention an insight the agent found based on the current scenario context.
                  3.  **Deliver the Punchline:** The trash talk should be a witty, slightly arrogant one-liner that implies the user is acting on information their opponent doesn't have.
                  
                  **Current Scenario Context:**
                  ---
                  ${context}
                  ---

                  **Your Trash Talk Response:**
                `;
            } else {
                // --- UPDATED: This is the new, more sophisticated main prompt ---
                fullPrompt = `
                  **Persona:** You are Neuron AI, the world's most advanced fantasy football co-pilot. You are the mission commander of a team of six specialized AI agents. Your personality is a mix of a brilliant, slightly arrogant strategist (think Dr. House meets Bill Belichick) and a witty, loyal teammate. You synthesize intel from your agents into actionable advice.

                  **Your Agent Team:**
                  - 🛰️ **DataStream:** Your intel gatherer.
                  - 🧠 **LiveAnalysis:** Your pattern-finder and analyst.
                  - 🎯 **LiveDecision:** Your core strategist and optimizer.
                  - ⚙️ **LiveExecution:** Your operator, who carries out approved actions.
                  - 📈 **PlatformArbitrage:** Your market specialist, finding the best ROI.
                  - ⚖️ **ComplianceMonitor:** Your legal and rules expert.

                  **Rules of Engagement:**
                  1.  **Narrate the Intel Flow:** Do not just give an answer. Start by explaining which agent provided the key piece of information, as if you're a commander receiving a report. Frame your responses as a synthesis of their work.
                      * **Good Example:** "My LiveAnalysis agent just flagged something interesting. The public is all over Player X, but the underlying metrics show a potential trap. Meanwhile, LiveDecision has modeled out a pivot to Player Y that gives us massive leverage."
                      * **Bad Example:** "You should pivot from Player X to Player Y."
                  2.  **Provide Sharp Insights:** Explain the "why" behind your recommendations. Use fantasy football terms like "leverage," "GPP," "cash games," "stacks," and "contrarian."
                  3.  **Inject Personality:** Be confident, sharp, and sometimes sarcastic, but always on the user's side.
                  4.  **Acknowledge Risk Profile:** The user has set their risk profile to "${userRiskProfile}". Tailor your recommendations to this setting. For "Conservative," suggest safer, high-floor plays. For "All-In," suggest high-risk, high-reward GPP plays.

                  **Current Scenario Context:**
                  ---
                  ${context}
                  ---

                  **User's Request:** "${interactionText}"

                  **Your Response:**
                `;
            }
            
            const chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
            const payload = { contents: chatHistory };
            
            const apiUrl = `/api/gemini`;
            
            try {
              const response = await fetch(apiUrl, { 
                  method: 'POST', 
                  headers: { 'Content-Type': 'application/json' }, 
                  body: JSON.stringify(payload) 
              });

              if (!response.ok) { throw new Error(`API request failed with status ${response.status}`); }
              
              const result = await response.json();
              
              let modelResponse = "Sorry, I couldn't process that request. Please try again.";
              if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                modelResponse = result.candidates[0].content.parts[0].text;
              }
              setMessages([...newMessages, { role: 'model', text: modelResponse }]);
            } catch (error) {
              console.error("API Error:", error);
              setMessages([...newMessages, { role: 'model', text: `Error: ${error.message}. Could not connect to the AI engine.` }]);
            } finally {
              setIsTyping(false);
            }
          };

          const handleGenerateTrashTalk = () => {
              const trashTalkPrompt = "Generate a witty, one-line trash talk message I can send to my fantasy football league opponent this week, based on the current scenario.";
              handleInteraction(trashTalkPrompt, true, true); // Pass true for isTrashTalk
          };

          const renderLeftColumn = () => {
            if (currentScenario.isStatic) {
              return (
                <div className="p-6">
                  <h2 className="text-2xl font-bold text-cyan-300 mb-4">{currentScenario.staticContent.title}</h2>
                  <p className="text-gray-400 mb-6">{currentScenario.staticContent.description}</p>
                  <div className="space-y-4">
                    {currentScenario.staticContent.points.map(point => (
                      <div key={point.title} className="bg-gray-900/50 p-4 rounded-lg border border-cyan-900/50">
                        <h3 className="font-semibold text-white">{point.title}</h3>
                        <p className="text-sm text-gray-300 mt-1">{point.text}</p>
                      </div>
                    ))}
                  </div>
                </div>
              );
            }
            return (
              <>
                <SystemStatus />
                <Controls items={currentScenario.controls} onAction={(prompt) => handleInteraction(prompt, true)} />
                <div className="flex-grow overflow-y-auto" style={{maxHeight: 'calc(100vh - 350px)'}}>
                    <LiveIntelligenceFeed data={currentScenario.feed} onAction={(prompt) => handleInteraction(prompt, true)} />
                    {currentScenario.strategicInsight && <StrategicInsight data={currentScenario.strategicInsight} />}
                    {currentScenario.sentiment && <SentimentGauge value={currentScenario.sentiment.value} label={currentScenario.sentiment.label} player={currentScenario.sentiment.player} />}
                    {currentScenario.portfolio && <PortfolioCommandCenter data={currentScenario.portfolio} />}
                    {currentScenario.players && currentScenario.players.map(p => <PlayerCard key={p.name} data={p} />)}
                </div>
              </>
            );
          };

          return (
            <div className="bg-[#0D1117] min-h-screen font-sans p-2 sm:p-4 flex flex-col items-center text-gray-200">
                <div className="w-full max-w-7xl mb-2 bg-yellow-900/50 text-yellow-300 text-center text-xs font-semibold p-2 rounded-lg border border-yellow-700/50">
                    For pure research purposes only - testing Neuron framework
                </div>
                <div className="w-full max-w-7xl mb-4">
                    <label htmlFor="scenario-select" className="block text-sm font-medium text-gray-400 mb-1">Select Test Scenario:</label>
                    <select
                        id="scenario-select"
                        value={scenarioId}
                        onChange={(e) => handleScenarioChange(Number(e.target.value))}
                        className="bg-gray-800 text-white w-full p-2 rounded-lg border border-cyan-900/50 focus:outline-none focus:ring-2 focus:ring-cyan-500"
                    >
                        {Object.values(scenarios).map(s => (<option key={s.id} value={s.id}>{s.id}: {s.title}</option>))}
                    </select>
                </div>

                <div className={`w-full max-w-7xl bg-[#161B22] rounded-lg shadow-2xl shadow-black/50 border border-cyan-900/50 flex flex-col lg:flex-row transition-opacity duration-300 ${isTransitioning ? 'opacity-0' : 'opacity-100'}`}>
                    <div className="w-full lg:w-3/5 flex flex-col border-r-0 lg:border-r border-cyan-900/50">
                        <Header data={currentScenario.header} statusColor={statusColor} />
                        {renderLeftColumn()}
                    </div>

                    <div className="w-full lg:w-2/5 flex flex-col">
                        {currentScenario.chat && <Chat 
                            messages={messages} 
                            suggestions={currentScenario.chat.suggestions}
                            onSendMessage={(prompt) => handleInteraction(prompt, false)}
                            isTyping={isTyping}
                            risk={risk}
                            setRisk={setRisk}
                            onGenerateTrashTalk={handleGenerateTrashTalk}
                        />}
                    </div>
                </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>


